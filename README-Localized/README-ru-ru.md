# <a name="excel-web-addin-for-manipulating-table-and-chart-formatting"></a>Веб-надстройка Excel для работы с форматированием таблиц и диаграмм

Узнайте, как программно форматировать таблицы и диаграммы, а также импортировать данные в электронную таблицу в веб-надстройках Excel. Сравните с тем, как эти задачи выполняются в надстройке VSTO [Tables and Charts](https://code.msdn.microsoft.com/VSTO-Generate-tables-and-f19859b3). Из этого примера вы также узнаете, как использовать [ шаблоны оформления надстроек Office](https://github.com/OfficeDev/Office-Add-in-UX-Design-Patterns-Code). 

## <a name="table-of-contents"></a>Содержание
* [История изменений](#change-history)
* [Необходимые компоненты](#prerequisites)
* [Шаблоны оформления, используемые в этой надстройке](#design-templates-used-in-this-add-in)
* [Получение библиотеки PickADate](get-the-pickadate-library)
* [Запуск проекта](#run-the-project)
* [Сравнение кода этой веб-надстройки Excel с примером надстройки VSTO](#compare-this-web-add-in-code-with-the-VSTO-add-in-sample)
* [Вопросы и комментарии](#questions-and-comments)
* [Дополнительные ресурсы](#additional-resources)

## <a name="change-history"></a>История изменений

2 ноября 2016 г.

* Исходная версия.

## <a name="prerequisites"></a>Необходимые компоненты

* Excel 2016 для Windows (сборка 16.0.6727.1000 или более новая), Excel Online или Excel для Mac (сборка 15.26 или более новая).
* Visual Studio 2015 

## <a name="design-templates-used-in-this-addin"></a>Шаблоны оформления, используемые в этой надстройке

- Целевая страница
- Панель с фирменной символикой
- Панель вкладок
- Параметры

Дополнительные сведения о шаблонах оформления см. в статье [Конструктивные шаблоны пользовательского интерфейса надстроек Office](https://dev.office.com/docs/add-ins/design/ux-design-patterns). Примеры реализации см. в статье [Office-Add-in-UX-Design-Patterns-Code](https://github.com/OfficeDev/Office-Add-in-UX-Design-Patterns-Code).

## <a name="get-the-pickadate-library"></a>Получение библиотеки PickADate

Элемент выбора даты Office Fabric зависит от библиотеки PickADate. *Прежде чем* выполнять указанные ниже действия, скачайте этот пример.

1. Скачайте библиотеку версии 3.5.3 из раздела [pickadate.js](https://github.com/amsul/pickadate.js/releases/tag/3.5.3). 
2. Распакуйте пакет и перейдите в папку `\pickadate.js-3.5.3\lib`. 
3. Скопируйте все файлы и папки в этой папке, *кроме* папок `compressed` и `themes-source`, в папку проекта: `SalesTrackerWeb\Scripts\PickADate`.

## <a name="run-the-project"></a>Запуск проекта

1. Откройте файл решения в Visual Studio. 
2. Нажмите клавишу **F5**. 
3. Когда Excel откроется, нажмите кнопку **Track sales** (Отслеживание продаж) в правой части ленты **Главная**. Надстройка откроется в области задач.

#### <a name="import-data"></a>Импорт данных

4. На **главной** странице введите одно из следующих названий продуктов (с учетом регистра) в поле **Product name** (Имя продукта): **Клавиатура**, **Мышь**, **Монитор**, **Ноутбук**.
5. Выберите дату не позднее 16 сентября 2016 г., так как в примере нет данных о продажах после этой даты.
6. Нажмите кнопку **Get sales data** (Получить данные о продажах). Через несколько секунд откроется новый лист **Sales** (Продажи). 

#### <a name="change-table-settings"></a>Изменение параметров таблицы

1. Выберите **Таблица** на панели вкладок. 
2. Скройте ненужные столбцы с помощью переключателей.
3. Выберите цвет таблицы.

#### <a name="change-chart-settings"></a>Изменение параметров диаграммы

1. Выберите **Диаграмма** на панели вкладок. 
2. Выберите источник данных для диаграммы.
3. Выберите тип диаграммы.
4. Выберите цветовую тему диаграммы.

## <a name="compare-this-excel-web-addin-code-with-the-vsto-addin-sample"></a>Сравнение кода этой веб-надстройки Excel с демонстрационной надстройкой VSTO

Код, который использует API JavaScript для Office и Word, находится в файлах Home.js и Helpers.js. Все оформление настраивается с помощью файлов таблицы стилей и HTML5: settings.css, tab.bar.css и нескольких файлов CSS Office Fabric.

Сравните этот код с кодом надстройки [Tables and Charts](https://code.msdn.microsoft.com/VSTO-Generate-tables-and-f19859b3). Внимание!


- Веб-надстройки Excel поддерживаются на нескольких платформах, в том числе Windows, Mac и Office Online. Надстройки VSTO поддерживаются только в Windows.
- Стиль таблицы в надстройке VSTO изменяется так же, как в веб-надстройке. В обоих случаях код назначает имя стиля, например TableStyleMedium3, свойству. В надстройке VSTO это объект таблицы. (См. различные методы `*_CheckedChanged` в файле TableAndChartPane.cs.) В этой веб-надстройке свойство находится в объекте JavaScript, который передается в функцию `setTableOptionsAsync`. (См. функцию `setTableColor` в файле helpers.js.)
- Столбцы в таблице в надстройке VSTO отображаются и скрываются почти так же, как в веб-надстройке. Сравните логику метода `ListObjectHeaders_Click` в примере VSTO с функцией `toggleColumnVisibility` в веб-надстройке.
- Чтобы изменить стиль диаграммы в надстройке VSTO, вы назначаете целое число свойству `ChartStyle` объекта диаграммы. Целое число указывает на коллекцию параметров стиля. См. файл TableAndChartPane.cs в надстройке VSTO. В веб-надстройке Excel вы заменяете диаграмму на новую с нужным стилем. Текущие параметры стиля диаграммы можно записывать в объекте JavaScript. В этом примере для этого используется файл home.js. Чтобы изменить один параметр стиля, код изменяет его в объекте параметров, который затем передается в функцию `changeChart` в файле helpers.js.
- *Тип* диаграммы, например Line, Area, ClusteredColumn (график, диаграмма с областями, гистограмма с группировкой), изменяется в надстройке VSTO так же, как в этой веб-надстройке. В обоих случаях для присвоения значения свойству type используется структура `switch-case`. Сравните метод `ChartStyleComboBox_SelectedIndexChanged` в примере VSTO с методом `setChartType` в этой веб-надстройке. 
- Чтобы отслеживать *одно* значение по времени (или любой горизонтальной оси) в веб-надстройке Excel, диаграмма должна быть построена на основе таблицы с двумя видимыми столбцами: один содержит данные для горизонтальной оси (в этом случае даты), а другой — значение, которое отображается на диаграмме. По этой причине надстройка создает *скрытый* лист с копией таблицы данных о продажах. Эта таблица содержит только два видимых столбца: столбец **Дата** и столбец с выбранным источником данных для диаграммы. Несмотря на то что диаграмма отображается на листе **Продажи** рядом с таблицей, источник ее данных — таблица на скрытом (временном) листе.
- Чтобы изменить источник данных для диаграммы в веб-надстройке Excel, код переключает видимость столбцов в скрытой таблице. См. метод `setChartDataSource` в файле helpers.js. В надстройке VSTO код определяет, какой столбец в таблице нужно использовать в качестве источника данных, вызывая функцию `SetSourceData` объекта диаграммы. См. метод `chartDataSourceComboBox_SelectedIndexChanged`.
- Для создания пользовательского интерфейса, как в этом примере кода, в веб-надстройках Office можно использовать файлы HTML5, JavaScript и CSS. 
- Так как веб-надстройки Office вызывают методы асинхронно, пользовательский интерфейс никогда не блокируется.
- Веб-надстройки Office получают данные от поставщиков интернет-служб через вызовы AJAX. В этом примере надстройка получает данные JSON из локального файла JSON. См. метод `getSalesData` в файле Helpers.js. Для доступа к веб-ресурсам надстройки VSTO используют веб-клиент в C#. См. метод `GetDataUpdatesFoOneDataSource` в файле TableAndChartPane.cs.   


## <a name="questions-and-comments"></a>Вопросы и комментарии

Мы будем рады узнать ваше мнение об этом примере. Своими мыслями можете поделиться на вкладке *Issues* (Проблемы) этого репозитория.

Общие вопросы о разработке решений для Microsoft Office 365 следует задавать на сайте [Stack Overflow](http://stackoverflow.com/questions/tagged/office-js+API). Если ваш вопрос касается API JavaScript для Office, добавьте к нему теги [office-js] и [API].

## <a name="additional-resources"></a>Дополнительные ресурсы

* [Документация по надстройкам Office](https://dev.office.com/docs/add-ins/overview/office-add-ins)
* [Центр разработки для Office](http://dev.office.com/)
* Другие примеры надстроек Office см. на странице [OfficeDev на Github](https://github.com/officedev).

## <a name="copyright"></a>Авторское право
© Корпорация Майкрософт (Microsoft Corporation), 2016 г. Все права защищены.

